"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[82],{82:(e,s,a)=>{a.r(s),a.d(s,{default:()=>m});var t=a(379),n=a(43),l=a(352),i=a(269),r=a(90),o=a(770),c=a(732),d=a(579);const m=()=>{const[e,s]=(0,n.useState)([]),[a,m]=(0,n.useState)(""),[h,p]=(0,n.useState)(!1),[u,g]=(0,n.useState)(!0),[x,v]=(0,n.useState)([]),[j,f]=(0,n.useState)("gpt-4o"),[N,b]=(0,n.useState)([]),w=(0,n.useRef)(null),y=(0,n.useRef)(null),C=(0,n.useRef)(null),k=(0,l.Zp)();(0,n.useEffect)(()=>{e.length>0&&(()=>{var e;null===(e=w.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()},[e]),(0,n.useEffect)(()=>{y.current&&(y.current.style.height="auto",y.current.style.height=Math.min(y.current.scrollHeight,200)+"px")},[a]);const A=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x;if(!e||0===e.trim().length||h)return;const l={role:"user",content:e.trim(),timestamp:new Date,files:n.length>0?n.map(e=>e.name):null};s(e=>[...e,l]);const i=[...N,{role:"user",content:e.trim()}];b(i),m(""),v([]),p(!0),g(!1);const r=Date.now(),o={id:r,role:"assistant",content:"",timestamp:new Date,isStreaming:!0};s(e=>[...e,o]);try{let a=null;n.length>0&&(a=await Promise.all(n.map(async e=>{return{name:e.name,type:e.type,size:e.size,content:await(s=e,new Promise((e,a)=>{const t=new FileReader;t.onload=()=>e(t.result.split(",")[1]),t.onerror=a,t.readAsDataURL(s)}))};var s})));const l=await fetch("".concat(c.A,"/ai-assistant/stream"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({prompt:e.trim(),model:j,conversationHistory:i.slice(-10),files:a})});if(401===l.status)return void(window.location.href="/#/");if(!l.ok)throw new Error("HTTP error! status: ".concat(l.status));const o=l.body.getReader(),m=new TextDecoder;let h="",p=null,u=null;for(;;){const{value:e,done:a}=await o.read();if(a)break;const n=m.decode(e,{stream:!0}).split("\n");for(const l of n)if(l.startsWith("data: ")){const e=l.slice(6);if("[DONE]"===e)continue;try{const a=JSON.parse(e);if(a.content&&(h+=a.content,s(e=>e.map(e=>e.id===r?(0,t.A)((0,t.A)({},e),{},{content:h}):e))),a.tokens&&(p=a.tokens),a.testGenerated&&(u=a.testData),a.error)throw new Error(a.error)}catch(d){console.warn("Parse error:",d)}}}s(e=>e.map(e=>{var s;return e.id===r?(0,t.A)((0,t.A)({},e),{},{isStreaming:!1,testGenerated:!!u,testArea:null===(s=u)||void 0===s?void 0:s.thematicArea,tokens:p}):e})),b(e=>[...e,{role:"assistant",content:h}])}catch(u){console.error("\u274c Errore AI:",u),s(e=>e.map(e=>e.id===r?(0,t.A)((0,t.A)({},e),{},{content:"\u274c Errore: ".concat(u.message||"Connessione fallita","\n\nProva a:\n\u2022 Verificare la connessione\n\u2022 Riformulare la richiesta\n\u2022 Ridurre la lunghezza del messaggio"),isStreaming:!1,isError:!0}):e))}finally{p(!1)}};return(0,d.jsxs)("div",{className:"ai-assistant-page",children:[(0,d.jsx)(r.A,{}),(0,d.jsx)(o.A,{variant:"floating",color:"purple"}),(0,d.jsx)(i.A,{}),(0,d.jsxs)("div",{className:"ai-container",children:[(0,d.jsxs)("div",{className:"ai-header",children:[(0,d.jsx)("h1",{children:"AI Assistant"}),(0,d.jsx)("div",{className:"ai-actions",children:(0,d.jsx)("button",{className:"icon-btn",onClick:()=>{window.confirm("Vuoi cancellare tutta la cronologia della chat?")&&(s([]),b([]),g(!0))},disabled:0===e.length,children:(0,d.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,d.jsx)("polyline",{points:"3 6 5 6 21 6"}),(0,d.jsx)("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})})]}),(0,d.jsxs)("div",{className:"chat-container",children:[(0,d.jsxs)("div",{className:"messages-area",children:[e.map((a,t)=>(0,d.jsx)("div",{className:"message ".concat(a.role," ").concat(a.isError?"error":""),children:(0,d.jsxs)("div",{className:"message-content",children:[(0,d.jsxs)("div",{className:"message-text",children:[a.content,a.isStreaming&&(0,d.jsx)("span",{className:"cursor",children:"|"})]}),"assistant"===a.role&&!a.isStreaming&&(0,d.jsxs)("div",{className:"message-actions",children:[(0,d.jsx)("button",{className:"action-btn",onClick:()=>{return e=a.content,void navigator.clipboard.writeText(e);var e},children:"Copy"}),(0,d.jsx)("button",{className:"action-btn",onClick:()=>(async a=>{if(a<1)return;const t=e[a-1];"user"===t.role&&(s(e=>e.slice(0,a)),b(e=>e.slice(0,a)),A(t.content))})(t),children:"Regenerate"})]}),a.testGenerated&&(0,d.jsx)("button",{className:"test-btn",onClick:()=>k("/dashboard"),children:"Go to Test \u2192"})]})},t)),h&&(0,d.jsx)("div",{className:"message assistant",children:(0,d.jsx)("div",{className:"message-content",children:(0,d.jsxs)("div",{className:"typing",children:[(0,d.jsx)("span",{}),(0,d.jsx)("span",{}),(0,d.jsx)("span",{})]})})}),(0,d.jsx)("div",{ref:w})]}),u&&0===e.length&&(0,d.jsx)("div",{className:"suggestions",children:["Storia: Seconda Guerra Mondiale","Matematica: Equazioni di secondo grado","Geografia: Capitali europee","Biologia: Corpo umano","Fisica: Meccanica classica","Letteratura: Decadentismo italiano"].slice(0,4).map((e,s)=>(0,d.jsx)("button",{className:"suggestion",onClick:()=>(e=>{m(e),A(e)})(e),children:e},s))}),x.length>0&&(0,d.jsx)("div",{className:"files",children:x.map((e,s)=>(0,d.jsxs)("div",{className:"file",children:[(0,d.jsx)("span",{children:e.name}),(0,d.jsx)("button",{onClick:()=>{return e=s,void v(s=>s.filter((s,a)=>a!==e));var e},children:"\xd7"})]},s))}),(0,d.jsxs)("div",{className:"input-container",children:[(0,d.jsx)("input",{type:"file",ref:C,onChange:e=>{const s=Array.from(e.target.files).filter(e=>["text/plain","application/pdf","image/png","image/jpeg"].includes(e.type)&&e.size<=10485760);v(e=>[...e,...s])},multiple:!0,accept:".txt,.pdf,.png,.jpg,.jpeg",style:{display:"none"}}),(0,d.jsxs)("div",{className:"input-wrapper",children:[(0,d.jsxs)("select",{value:j,onChange:e=>f(e.target.value),disabled:h,className:"model-select",children:[(0,d.jsx)("option",{value:"gpt-4o",children:"GPT-4o"}),(0,d.jsx)("option",{value:"gpt-4o-mini",children:"GPT-4o Mini"}),(0,d.jsx)("option",{value:"o1-preview",children:"O1 Preview"})]}),(0,d.jsx)("textarea",{ref:y,className:"input",placeholder:"Message AI...",value:a,onChange:e=>m(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),A())},rows:1,disabled:h}),(0,d.jsx)("button",{className:"send",onClick:()=>A(),disabled:h||!a.trim(),children:h?"...":"\u2192"})]})]})]})]})]})}},90:(e,s,a)=>{a.d(s,{A:()=>i});var t=a(43),n=a(579);const l=(0,t.memo)(()=>(0,n.jsx)("div",{className:"page-bg-wrapper","aria-hidden":"true",children:(0,n.jsx)("img",{className:"page-bg",src:"/sfondo_pages.jpg",alt:"",loading:"lazy"})}));l.displayName="PageBackground";const i=l},269:(e,s,a)=>{a.d(s,{A:()=>d});var t=a(43),n=a(352),l=a(930),i=a(496),r=a(711),o=a(579);const c=(0,t.memo)(()=>{const e=(0,n.Zp)(),s=(0,n.zy)(),{theme:a,toggleTheme:t}=(0,i.D)(),{t:c}=(0,l.Bd)(),d=e=>s.pathname===e||s.pathname.startsWith(e);return(0,o.jsxs)("div",{className:"dashboard-topbar",children:[(0,o.jsx)("button",{className:"topbar-btn".concat(d("/dashboard")?" active":""),onClick:()=>e("/dashboard"),children:c("topbar.home")}),(0,o.jsx)("button",{className:"topbar-btn".concat(d("/ai-assistant")?" active":""),onClick:()=>e("/ai-assistant"),children:c("topbar.aiAssistant")}),(0,o.jsx)("button",{className:"topbar-btn".concat(d("/statistiche")?" active":""),onClick:()=>e("/statistiche"),children:c("topbar.statistics")}),(0,o.jsx)(r.A,{}),(0,o.jsx)("button",{className:"theme-toggle-btn",onClick:t,"aria-label":c("landing.changeTheme"),title:c("light"===a?"landing.darkTheme":"landing.lightTheme"),children:"light"===a?"\ud83c\udf19":"\u2600\ufe0f"})]})});c.displayName="Topbar";const d=c},770:(e,s,a)=>{a.d(s,{A:()=>n});a(43);var t=a(579);function n(e){let{variant:s="corner",color:a="blue"}=e;const n=()=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"led-corner led-top-left led-".concat(a),children:[(0,t.jsx)("div",{className:"led-dot"}),(0,t.jsx)("div",{className:"led-line led-line-horizontal"}),(0,t.jsx)("div",{className:"led-line led-line-vertical"})]}),(0,t.jsxs)("div",{className:"led-corner led-top-right led-".concat(a),children:[(0,t.jsx)("div",{className:"led-dot"}),(0,t.jsx)("div",{className:"led-line led-line-horizontal"}),(0,t.jsx)("div",{className:"led-line led-line-vertical"})]}),(0,t.jsxs)("div",{className:"led-corner led-bottom-left led-".concat(a),children:[(0,t.jsx)("div",{className:"led-dot"}),(0,t.jsx)("div",{className:"led-line led-line-horizontal"}),(0,t.jsx)("div",{className:"led-line led-line-vertical"})]}),(0,t.jsxs)("div",{className:"led-corner led-bottom-right led-".concat(a),children:[(0,t.jsx)("div",{className:"led-dot"}),(0,t.jsx)("div",{className:"led-line led-line-horizontal"}),(0,t.jsx)("div",{className:"led-line led-line-vertical"})]})]}),l=()=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"led-floating led-float-1 led-".concat(a)}),(0,t.jsx)("div",{className:"led-floating led-float-2 led-".concat(a)}),(0,t.jsx)("div",{className:"led-floating led-float-3 led-".concat(a)}),(0,t.jsx)("div",{className:"led-floating led-float-4 led-".concat(a)}),(0,t.jsx)("div",{className:"led-floating led-float-5 led-".concat(a)})]});return(0,t.jsxs)("div",{className:"led-effect-container",children:["corner"===s&&n(),"floating"===s&&l(),"border"===s&&(0,t.jsxs)("div",{className:"led-border-container led-".concat(a),children:[(0,t.jsxs)("svg",{className:"led-border-svg",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[(0,t.jsx)("defs",{children:(0,t.jsxs)("linearGradient",{id:"ledGrad-".concat(a),x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,t.jsx)("stop",{offset:"0%",stopColor:"currentColor",stopOpacity:"0",children:(0,t.jsx)("animate",{attributeName:"stop-opacity",values:"0;0.8;0",dur:"3s",repeatCount:"indefinite"})}),(0,t.jsx)("stop",{offset:"50%",stopColor:"currentColor",stopOpacity:"0.8",children:(0,t.jsx)("animate",{attributeName:"stop-opacity",values:"0.3;1;0.3",dur:"3s",repeatCount:"indefinite"})}),(0,t.jsx)("stop",{offset:"100%",stopColor:"currentColor",stopOpacity:"0",children:(0,t.jsx)("animate",{attributeName:"stop-opacity",values:"0;0.8;0",dur:"3s",repeatCount:"indefinite"})})]})}),(0,t.jsx)("rect",{x:"0",y:"0",width:"100",height:"100",fill:"none",stroke:"url(#ledGrad-".concat(a,")"),strokeWidth:"0.5",className:"led-border-rect"})]}),(0,t.jsx)("div",{className:"led-corner-glow led-corner-glow-tl"}),(0,t.jsx)("div",{className:"led-corner-glow led-corner-glow-tr"}),(0,t.jsx)("div",{className:"led-corner-glow led-corner-glow-bl"}),(0,t.jsx)("div",{className:"led-corner-glow led-corner-glow-br"})]}),"full"===s&&(0,t.jsxs)(t.Fragment,{children:[n(),l()]})]})}}}]);
//# sourceMappingURL=82.375be2a1.chunk.js.map
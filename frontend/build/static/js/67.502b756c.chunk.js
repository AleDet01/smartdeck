"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[67],{67:(e,s,t)=>{t.r(s),t.d(s,{default:()=>o});var n=t(43),a=t(352),r=t(930),i=t(269),l=t(732),c=t(579);function o(){const{area:e,num:s}=(0,a.g)(),{t:t}=(0,r.Bd)(),[o,d]=(0,n.useState)([]),[h,u]=(0,n.useState)(0),[m,g]=(0,n.useState)([]),[x,v]=(0,n.useState)(null),[j,p]=(0,n.useState)(!1),[b]=(0,n.useState)(Date.now()),[N,w]=(0,n.useState)(!1),f=(0,a.Zp)();(0,n.useEffect)(()=>{const t=new AbortController;return(async()=>{try{const a=await fetch("".concat(l.A,"/flash/thematic/").concat(e),{signal:t.signal,credentials:"include"});if(!a.ok)throw new Error("HTTP ".concat(a.status));const r=await a.json(),i=r.sort(()=>.5-Math.random()).slice(0,parseInt(s));d(n=i),g(Array(n.length).fill(null)),v(null),p(!1),w(!1)}catch(a){if("AbortError"===a.name)return;console.error("Failed to load flashcards for test:",a.message),d([])}var n})(),()=>t.abort()},[e,s]);if((0,n.useEffect)(()=>{if(!j||N||0===o.length)return;(async()=>{try{const s=m.filter((e,s)=>{var t;const n=null===(t=o[s])||void 0===t?void 0:t.answers[e];return null===n||void 0===n?void 0:n.isCorrect}).length,t=Math.round(s/o.length*100),n=Math.floor((Date.now()-b)/1e3),a={thematicArea:e,totalQuestions:o.length,correctAnswers:s,wrongAnswers:o.length-s,score:t,duration:n,questions:o.map((e,s)=>{const t=m[s],n="number"===typeof t?e.answers[t]:null,a=e.answers.find(e=>e.isCorrect),r=e.answers.findIndex(e=>e.isCorrect);return{questionId:e._id,questionText:e.question,userAnswerIndex:null!==t&&void 0!==t?t:-1,userAnswerText:(null===n||void 0===n?void 0:n.text)||"Nessuna risposta",correctAnswerIndex:r,correctAnswerText:(null===a||void 0===a?void 0:a.text)||"",isCorrect:(null===n||void 0===n?void 0:n.isCorrect)||!1,timeSpent:0}})};await fetch("".concat(l.A,"/statistics/session"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)}),w(!0)}catch(s){console.error("Errore nel salvare la sessione:",s)}})()},[j,N,o,m,e,b]),!o.length)return(0,c.jsxs)("div",{className:"test-page",children:[(0,c.jsx)("div",{className:"page-bg-wrapper","aria-hidden":"true",children:(0,c.jsx)("img",{className:"page-bg",src:"/sfondo_pages.jpg",alt:"",loading:"lazy"})}),(0,c.jsx)(i.A,{}),(0,c.jsx)("div",{style:{padding:24},children:t("test.loading")})]});const A=o[h];if(j){const s=m.filter((e,s)=>{var t;const n=null===(t=o[s])||void 0===t?void 0:t.answers[e];return null===n||void 0===n?void 0:n.isCorrect}).length,n=Math.round(s/o.length*100);return(0,c.jsxs)("div",{className:"test-page",children:[(0,c.jsx)("div",{className:"page-bg-wrapper","aria-hidden":"true",children:(0,c.jsx)("img",{className:"page-bg",src:"/sfondo_pages.jpg",alt:"",loading:"lazy"})}),(0,c.jsx)(i.A,{}),(0,c.jsx)("div",{style:{paddingTop:88},children:(0,c.jsxs)("div",{className:"header",children:[(0,c.jsxs)("h2",{children:[t("test.result")," ",(0,c.jsx)("span",{className:"header-accent",children:e})]}),(0,c.jsx)("div",{className:"go-tests",children:(0,c.jsx)("button",{className:"modern-btn",onClick:()=>f("/dashboard"),children:t("test.backToDashboard")})})]})}),(0,c.jsxs)("div",{className:"test-stats-box",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("b",{children:t("test.totalQuestions")})," ",o.length]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("b",{children:t("test.correct")})," ",s]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("b",{children:t("test.percentage")})," ",n,"%"]})]}),(0,c.jsxs)("div",{className:"results-grid",children:[(0,c.jsx)("b",{children:t("test.wrongQuestions")}),(0,c.jsx)("div",{className:"container",children:(0,c.jsxs)("div",{className:"question-item",children:[o.map((e,s)=>{const n=m[s],a="number"===typeof n?e.answers[n]:null,r=e.answers.find(e=>e.isCorrect);return(null===a||void 0===a?void 0:a.isCorrect)?null:(0,c.jsxs)("div",{className:"question-box",children:[(0,c.jsxs)("div",{className:"q-title",children:[s+1,". ",e.question]}),(0,c.jsxs)("div",{className:"answer-given",children:[t("test.yourAnswer")," ",(0,c.jsx)("span",{className:"wrong",children:(null===a||void 0===a?void 0:a.text)||t("test.none")})]}),(0,c.jsxs)("div",{className:"answer-correct",children:[t("test.correctAnswer")," ",(0,c.jsx)("span",{className:"correct",children:null===r||void 0===r?void 0:r.text})]})]},s)}),s===o.length&&(0,c.jsx)("div",{className:"all-correct",children:t("test.allCorrect")})]})})]})]})}return(0,c.jsxs)("div",{className:"test-page",children:[(0,c.jsx)("div",{className:"page-bg-wrapper","aria-hidden":"true",children:(0,c.jsx)("img",{className:"page-bg",src:"/sfondo_pages.jpg",alt:"",loading:"lazy"})}),(0,c.jsx)(i.A,{}),(0,c.jsxs)("div",{className:"test-content",children:[(0,c.jsxs)("h2",{className:"question-count",children:[t("test.question")," ",h+1," / ",o.length]}),(0,c.jsxs)("div",{className:"flashcard",children:[(0,c.jsx)("div",{className:"question",children:A.question}),(0,c.jsx)("div",{className:"answers",children:A.answers.map((e,s)=>(0,c.jsx)("button",{className:x===s?"modern-btn selected":"modern-btn",onClick:()=>!j&&(e=>{var s,t;null===x&&(v(e),g(s=>{const t=[...s];return t[h]=e,t}),null===(s=document.activeElement)||void 0===s||null===(t=s.blur)||void 0===t||t.call(s),setTimeout(()=>{v(null),h<o.length-1?u(e=>e+1):p(!0)},300))})(s),disabled:j,children:e.text},s))})]}),(0,c.jsx)("div",{className:"test-nav",children:(0,c.jsx)("button",{className:"modern-btn",onClick:()=>u(e=>Math.max(0,e-1)),disabled:0===h,children:t("test.back")})})]})]})}},269:(e,s,t)=>{t.d(s,{A:()=>d});var n=t(43),a=t(352),r=t(930),i=t(496),l=t(711),c=t(579);const o=(0,n.memo)(()=>{const e=(0,a.Zp)(),s=(0,a.zy)(),{theme:t,toggleTheme:n}=(0,i.D)(),{t:o}=(0,r.Bd)(),d=e=>s.pathname===e||s.pathname.startsWith(e);return(0,c.jsxs)("div",{className:"dashboard-topbar",children:[(0,c.jsx)("button",{className:"topbar-btn".concat(d("/dashboard")?" active":""),onClick:()=>e("/dashboard"),children:o("topbar.home")}),(0,c.jsx)("button",{className:"topbar-btn".concat(d("/ai-assistant")?" active":""),onClick:()=>e("/ai-assistant"),children:o("topbar.aiAssistant")}),(0,c.jsx)("button",{className:"topbar-btn".concat(d("/statistiche")?" active":""),onClick:()=>e("/statistiche"),children:o("topbar.statistics")}),(0,c.jsx)(l.A,{}),(0,c.jsx)("button",{className:"theme-toggle-btn",onClick:n,"aria-label":o("landing.changeTheme"),title:o("light"===t?"landing.darkTheme":"landing.lightTheme"),children:"light"===t?"\ud83c\udf19":"\u2600\ufe0f"})]})});o.displayName="Topbar";const d=o}}]);
//# sourceMappingURL=67.502b756c.chunk.js.map